import { PrismaClient } from '@prisma/client'
import bcrypt from 'bcryptjs'

const prisma = new PrismaClient()

async function main() {
  console.log('â³ à¸à¸³à¸¥à¸±à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸šà¸±à¸à¸Šà¸µ Admin...')

  // 1. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸à¹ˆà¸­à¸™à¸§à¹ˆà¸²à¹€à¸„à¸¢à¸¡à¸µ Admin à¸£à¸«à¸±à¸ªà¸™à¸µà¹‰à¹ƒà¸™à¸£à¸°à¸šà¸šà¸«à¸£à¸·à¸­à¸¢à¸±à¸‡ (à¸ˆà¸°à¹„à¸”à¹‰à¹„à¸¡à¹ˆà¸ªà¸£à¹‰à¸²à¸‡à¸‹à¹‰à¸³)
  const existingAdmin = await prisma.user.findUnique({
    where: { code: 'admin' },
  })

  if (existingAdmin) {
    console.log('âš ï¸ à¸¡à¸µà¸šà¸±à¸à¸Šà¸µ Admin à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸£à¸°à¸šà¸šà¹à¸¥à¹‰à¸§ à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹ƒà¸«à¸¡à¹ˆ')
    return
  }

  // 2. à¹€à¸‚à¹‰à¸²à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹€à¸žà¸·à¹ˆà¸­à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢ (à¹€à¸£à¸²à¸ˆà¸°à¸•à¸±à¹‰à¸‡à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¹€à¸›à¹‡à¸™ 123456)
  const hashedPassword = await bcrypt.hash('123456', 10)

  // 3. à¸ªà¸±à¹ˆà¸‡à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¸‡à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
  const admin = await prisma.user.create({
    data: {
      code: 'admin',          // à¸£à¸«à¸±à¸ªà¸›à¸£à¸°à¸ˆà¸³à¸•à¸±à¸§ (à¹ƒà¸Šà¹‰à¸¥à¹‡à¸­à¸à¸­à¸´à¸™)
      password: hashedPassword, // à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¸—à¸µà¹ˆà¹€à¸‚à¹‰à¸²à¸£à¸«à¸±à¸ªà¹à¸¥à¹‰à¸§
      firstName: 'à¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥à¸£à¸°à¸šà¸š',
      lastName: 'à¸ªà¸¹à¸‡à¸ªà¸¸à¸”',
      role: 'ADMIN',          // à¸à¸³à¸«à¸™à¸”à¸ªà¸´à¸—à¸˜à¸´à¹Œà¹€à¸›à¹‡à¸™ ADMIN
    },
  })

  console.log('ðŸŽ‰ à¸ªà¸£à¹‰à¸²à¸‡à¸šà¸±à¸à¸Šà¸µ Admin à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§!')
  console.log('--------------------------------')
  console.log('à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ (à¸£à¸«à¸±à¸ª):', admin.code)
  console.log('à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™:', '123456')
  console.log('--------------------------------')
}

// à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸ªà¸³à¸«à¸£à¸±à¸šà¸£à¸±à¸™à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸”à¹‰à¸²à¸™à¸šà¸™
main()
  .catch((e) => {
    console.error('âŒ à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”:', e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })